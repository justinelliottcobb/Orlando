<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orlando vs Popular Libraries - Benchmark Comparison</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            line-height: 1.6;
        }
        h1 { color: #2c3e50; }
        h2 { color: #34495e; margin-top: 30px; }
        .benchmark {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .results {
            margin: 20px 0;
        }
        .library-result {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .library-result.winner {
            background: #d4edda;
            border-color: #28a745;
            font-weight: bold;
        }
        .library-name {
            width: 150px;
            font-weight: 600;
        }
        .library-bar {
            flex: 1;
            height: 30px;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 4px;
            position: relative;
            margin: 0 15px;
        }
        .library-result.winner .library-bar {
            background: linear-gradient(90deg, #28a745, #218838);
        }
        .library-time {
            min-width: 100px;
            text-align: right;
        }
        .library-speedup {
            min-width: 120px;
            text-align: right;
            font-size: 14px;
            color: #666;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>âš¡ Orlando vs Popular Libraries</h1>
    <p>Comprehensive performance comparison against leading JavaScript utility libraries.</p>

    <div class="info">
        <strong>Libraries Tested:</strong>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #28a745;"></div>
                <span>Orlando (WASM Transducers)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>Native Array Methods</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span>Underscore.js</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Ramda</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>Lodash</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #1abc9c;"></div>
                <span>Lazy.js</span>
            </div>
        </div>
    </div>

    <div class="benchmark">
        <h2>Benchmark 1: Map â†’ Filter â†’ Take (100K items)</h2>
        <p>Double numbers, filter divisible by 3, take first 10. Tests early termination benefits.</p>
        <button onclick="runBenchmark1()" id="btn1">Run Benchmark</button>
        <div id="results1"></div>
    </div>

    <div class="benchmark">
        <h2>Benchmark 2: Complex Pipeline (10 operations, 50K items)</h2>
        <p>Chain 10 operations to test composition efficiency with complex transformations.</p>
        <button onclick="runBenchmark2()" id="btn2">Run Benchmark</button>
        <div id="results2"></div>
    </div>

    <div class="benchmark">
        <h2>Benchmark 3: Early Termination (1M items)</h2>
        <p>Find first 5 items matching condition. Shows massive speedup with early termination.</p>
        <button onclick="runBenchmark3()" id="btn3">Run Benchmark</button>
        <div id="results3"></div>
    </div>

    <div class="benchmark">
        <h2>Benchmark 4: Object Processing (100K objects)</h2>
        <p>Filter and transform complex objects. Real-world data processing scenario.</p>
        <button onclick="runBenchmark4()" id="btn4">Run Benchmark</button>
        <div id="results4"></div>
    </div>

    <!-- Load libraries from CDN -->
    <script src="https://unpkg.com/underscore@1.13.6/underscore-min.js"></script>
    <script src="https://unpkg.com/ramda@0.29.1/dist/ramda.min.js"></script>
    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://unpkg.com/lazy.js@0.5.1/lazy.min.js"></script>

    <script type="module">
        import init, { Pipeline } from '../pkg/orlando_transducers.js';

        let wasmReady = false;

        await init();
        wasmReady = true;

        // Benchmark utility
        function benchmark(name, fn, iterations = 10) {
            const times = [];

            // Warm-up
            for (let i = 0; i < 3; i++) {
                fn();
            }

            // Actual benchmark
            for (let i = 0; i < iterations; i++) {
                const start = performance.now();
                fn();
                const end = performance.now();
                times.push(end - start);
            }

            const avg = times.reduce((a, b) => a + b, 0) / times.length;
            const min = Math.min(...times);
            const max = Math.max(...times);

            return { avg, min, max };
        }

        // Display results
        function displayResults(containerId, results) {
            // Sort by average time (fastest first)
            const sorted = Object.entries(results)
                .map(([name, time]) => ({ name, ...time }))
                .sort((a, b) => a.avg - b.avg);

            const fastest = sorted[0];

            // Color mapping
            const colors = {
                'Orlando': '#28a745',
                'Native Array': '#3498db',
                'Underscore': '#9b59b6',
                'Ramda': '#e74c3c',
                'Lodash': '#f39c12',
                'Lazy.js': '#1abc9c'
            };

            const html = sorted.map((result, index) => {
                const isWinner = index === 0;
                const speedup = fastest.avg / result.avg;
                const speedupText = isWinner
                    ? 'ðŸ‘‘ Fastest'
                    : `${speedup.toFixed(2)}x slower`;

                const barWidth = (fastest.avg / result.avg) * 100;

                return `
                    <div class="library-result ${isWinner ? 'winner' : ''}">
                        <div class="library-name">${result.name}</div>
                        <div class="library-bar" style="width: ${barWidth}%; background: linear-gradient(90deg, ${colors[result.name]}, ${colors[result.name]}dd);"></div>
                        <div class="library-time">${result.avg.toFixed(2)}ms</div>
                        <div class="library-speedup">${speedupText}</div>
                    </div>
                `;
            }).join('');

            document.getElementById(containerId).innerHTML = `
                <div class="results">
                    ${html}
                </div>
            `;
        }

        window.runBenchmark1 = function() {
            if (!wasmReady) return;

            const btn = document.getElementById('btn1');
            btn.disabled = true;
            document.getElementById('results1').innerHTML = '<div class="loading"><div class="spinner"></div>Running benchmark...</div>';

            setTimeout(() => {
                const data = Array.from({ length: 100000 }, (_, i) => i + 1);

                const results = {
                    'Orlando': benchmark('Orlando', () => {
                        const pipeline = new Pipeline()
                            .map(x => x * 2)
                            .filter(x => x % 3 === 0)
                            .take(10);
                        return pipeline.toArray(data);
                    }),
                    'Native Array': benchmark('Native', () => {
                        return data
                            .map(x => x * 2)
                            .filter(x => x % 3 === 0)
                            .slice(0, 10);
                    }),
                    'Underscore': benchmark('Underscore', () => {
                        return _.chain(data)
                            .map(x => x * 2)
                            .filter(x => x % 3 === 0)
                            .first(10)
                            .value();
                    }),
                    'Ramda': benchmark('Ramda', () => {
                        return R.pipe(
                            R.map(x => x * 2),
                            R.filter(x => x % 3 === 0),
                            R.take(10)
                        )(data);
                    }),
                    'Lodash': benchmark('Lodash', () => {
                        return _.chain(data)
                            .map(x => x * 2)
                            .filter(x => x % 3 === 0)
                            .take(10)
                            .value();
                    }),
                    'Lazy.js': benchmark('Lazy.js', () => {
                        return Lazy(data)
                            .map(x => x * 2)
                            .filter(x => x % 3 === 0)
                            .take(10)
                            .toArray();
                    })
                };

                displayResults('results1', results);
                btn.disabled = false;
            }, 100);
        };

        window.runBenchmark2 = function() {
            if (!wasmReady) return;

            const btn = document.getElementById('btn2');
            btn.disabled = true;
            document.getElementById('results2').innerHTML = '<div class="loading"><div class="spinner"></div>Running benchmark...</div>';

            setTimeout(() => {
                const data = Array.from({ length: 50000 }, (_, i) => i + 1);

                const results = {
                    'Orlando': benchmark('Orlando', () => {
                        const pipeline = new Pipeline()
                            .map(x => x + 1)
                            .filter(x => x % 2 === 0)
                            .map(x => x * 3)
                            .filter(x => x > 10)
                            .map(x => x / 2)
                            .filter(x => x % 5 === 0)
                            .map(x => x - 1)
                            .filter(x => x < 10000)
                            .map(x => x * 2)
                            .take(100);
                        return pipeline.toArray(data);
                    }),
                    'Native Array': benchmark('Native', () => {
                        return data
                            .map(x => x + 1)
                            .filter(x => x % 2 === 0)
                            .map(x => x * 3)
                            .filter(x => x > 10)
                            .map(x => x / 2)
                            .filter(x => x % 5 === 0)
                            .map(x => x - 1)
                            .filter(x => x < 10000)
                            .map(x => x * 2)
                            .slice(0, 100);
                    }),
                    'Underscore': benchmark('Underscore', () => {
                        return _.chain(data)
                            .map(x => x + 1)
                            .filter(x => x % 2 === 0)
                            .map(x => x * 3)
                            .filter(x => x > 10)
                            .map(x => x / 2)
                            .filter(x => x % 5 === 0)
                            .map(x => x - 1)
                            .filter(x => x < 10000)
                            .map(x => x * 2)
                            .first(100)
                            .value();
                    }),
                    'Ramda': benchmark('Ramda', () => {
                        return R.pipe(
                            R.map(x => x + 1),
                            R.filter(x => x % 2 === 0),
                            R.map(x => x * 3),
                            R.filter(x => x > 10),
                            R.map(x => x / 2),
                            R.filter(x => x % 5 === 0),
                            R.map(x => x - 1),
                            R.filter(x => x < 10000),
                            R.map(x => x * 2),
                            R.take(100)
                        )(data);
                    }),
                    'Lodash': benchmark('Lodash', () => {
                        return _.chain(data)
                            .map(x => x + 1)
                            .filter(x => x % 2 === 0)
                            .map(x => x * 3)
                            .filter(x => x > 10)
                            .map(x => x / 2)
                            .filter(x => x % 5 === 0)
                            .map(x => x - 1)
                            .filter(x => x < 10000)
                            .map(x => x * 2)
                            .take(100)
                            .value();
                    }),
                    'Lazy.js': benchmark('Lazy.js', () => {
                        return Lazy(data)
                            .map(x => x + 1)
                            .filter(x => x % 2 === 0)
                            .map(x => x * 3)
                            .filter(x => x > 10)
                            .map(x => x / 2)
                            .filter(x => x % 5 === 0)
                            .map(x => x - 1)
                            .filter(x => x < 10000)
                            .map(x => x * 2)
                            .take(100)
                            .toArray();
                    })
                };

                displayResults('results2', results);
                btn.disabled = false;
            }, 100);
        };

        window.runBenchmark3 = function() {
            if (!wasmReady) return;

            const btn = document.getElementById('btn3');
            btn.disabled = true;
            document.getElementById('results3').innerHTML = '<div class="loading"><div class="spinner"></div>Running benchmark...</div>';

            setTimeout(() => {
                const data = Array.from({ length: 1000000 }, (_, i) => i + 1);

                const results = {
                    'Orlando': benchmark('Orlando', () => {
                        const pipeline = new Pipeline()
                            .filter(x => x % 137 === 0)
                            .take(5);
                        return pipeline.toArray(data);
                    }, 5),
                    'Native Array': benchmark('Native', () => {
                        return data
                            .filter(x => x % 137 === 0)
                            .slice(0, 5);
                    }, 5),
                    'Underscore': benchmark('Underscore', () => {
                        return _.chain(data)
                            .filter(x => x % 137 === 0)
                            .first(5)
                            .value();
                    }, 5),
                    'Ramda': benchmark('Ramda', () => {
                        return R.pipe(
                            R.filter(x => x % 137 === 0),
                            R.take(5)
                        )(data);
                    }, 5),
                    'Lodash': benchmark('Lodash', () => {
                        return _.chain(data)
                            .filter(x => x % 137 === 0)
                            .take(5)
                            .value();
                    }, 5),
                    'Lazy.js': benchmark('Lazy.js', () => {
                        return Lazy(data)
                            .filter(x => x % 137 === 0)
                            .take(5)
                            .toArray();
                    }, 5)
                };

                displayResults('results3', results);
                btn.disabled = false;
            }, 100);
        };

        window.runBenchmark4 = function() {
            if (!wasmReady) return;

            const btn = document.getElementById('btn4');
            btn.disabled = true;
            document.getElementById('results4').innerHTML = '<div class="loading"><div class="spinner"></div>Running benchmark...</div>';

            setTimeout(() => {
                const data = Array.from({ length: 100000 }, (_, i) => ({
                    id: i,
                    value: Math.random() * 1000,
                    active: Math.random() > 0.5
                }));

                const results = {
                    'Orlando': benchmark('Orlando', () => {
                        const pipeline = new Pipeline()
                            .filter(item => item.active)
                            .filter(item => item.value > 100)
                            .map(item => ({ id: item.id, score: item.value * 2 }))
                            .filter(item => item.score < 1500)
                            .take(1000);
                        return pipeline.toArray(data);
                    }),
                    'Native Array': benchmark('Native', () => {
                        return data
                            .filter(item => item.active)
                            .filter(item => item.value > 100)
                            .map(item => ({ id: item.id, score: item.value * 2 }))
                            .filter(item => item.score < 1500)
                            .slice(0, 1000);
                    }),
                    'Underscore': benchmark('Underscore', () => {
                        return _.chain(data)
                            .filter(item => item.active)
                            .filter(item => item.value > 100)
                            .map(item => ({ id: item.id, score: item.value * 2 }))
                            .filter(item => item.score < 1500)
                            .first(1000)
                            .value();
                    }),
                    'Ramda': benchmark('Ramda', () => {
                        return R.pipe(
                            R.filter(item => item.active),
                            R.filter(item => item.value > 100),
                            R.map(item => ({ id: item.id, score: item.value * 2 })),
                            R.filter(item => item.score < 1500),
                            R.take(1000)
                        )(data);
                    }),
                    'Lodash': benchmark('Lodash', () => {
                        return _.chain(data)
                            .filter(item => item.active)
                            .filter(item => item.value > 100)
                            .map(item => ({ id: item.id, score: item.value * 2 }))
                            .filter(item => item.score < 1500)
                            .take(1000)
                            .value();
                    }),
                    'Lazy.js': benchmark('Lazy.js', () => {
                        return Lazy(data)
                            .filter(item => item.active)
                            .filter(item => item.value > 100)
                            .map(item => ({ id: item.id, score: item.value * 2 }))
                            .filter(item => item.score < 1500)
                            .take(1000)
                            .toArray();
                    })
                };

                displayResults('results4', results);
                btn.disabled = false;
            }, 100);
        };
    </script>
</body>
</html>
